do nothing
[Modelarts Service Log]user: uid=1101(work) gid=1101(work) groups=1101(work)
[Modelarts Service Log]pwd: /home/work
[Modelarts Service Log]app_url: s3://zoey114/MA-01-15-18-26/code/
[Modelarts Service Log]boot_file: code/ASR.py
[Modelarts Service Log]log_url: /tmp/log/MA-01-15-18-26.log
[Modelarts Service Log]command: code/ASR.py --data_url=s3://zoey114/data_thchs30/data/ --train_url=s3://zoey114/MA-01-15-18-26/output/V0024/ --num_gpus=1
[Modelarts Service Log]MODELARTS_IPOIB_DEVICE: 
[Modelarts Service Log]dependencies_file_dir: /home/work/user-job-dir/code
[Modelarts Service Log][modelarts_create_log] modelarts-pipe found
[Modelarts Service Log]handle inputs of training job
INFO:root:Using MoXing-v1.17.3-4c644d5b
INFO:root:Using OBS-Python-SDK-3.20.7
[ModelArts Service Log][INFO][2021/01/16 22:56:50]: env MA_INPUTS is not found, skip the inputs handler
INFO:root:Using MoXing-v1.17.3-4c644d5b
INFO:root:Using OBS-Python-SDK-3.20.7
[ModelArts Service Log]2021-01-16 22:56:50,835 - modelarts-downloader.py[line:619] - INFO: Main: modelarts-downloader starting with Namespace(dst='./', recursive=True, skip_creating_dir=False, src='s3://zoey114/MA-01-15-18-26/code/', trace=False, type='common', verbose=False)
/home/work/user-job-dir
[Modelarts Service Log][modelarts_logger] modelarts-pipe found
INFO:root:Using MoXing-v1.17.3-4c644d5b
INFO:root:Using OBS-Python-SDK-3.20.7
Using TensorFlow backend.
语音模型建立完成！
WARNING:tensorflow:From /home/work/anaconda/lib/python3.6/site-packages/tensorflow/python/framework/op_def_library.py:263: colocate_with (from tensorflow.python.framework.ops) is deprecated and will be removed in a future version.
Instructions for updating:
Colocations handled automatically by placer.
2021-01-16 22:56:57.854079: I tensorflow/core/platform/cpu_feature_guard.cc:141] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2 AVX512F FMA
2021-01-16 22:56:58.040259: I tensorflow/compiler/xla/service/service.cc:150] XLA service 0x55a26a1b3920 executing computations on platform CUDA. Devices:
2021-01-16 22:56:58.040296: I tensorflow/compiler/xla/service/service.cc:158]   StreamExecutor device (0): Tesla V100-PCIE-32GB, Compute Capability 7.0
2021-01-16 22:56:58.069479: I tensorflow/core/platform/profile_utils/cpu_utils.cc:94] CPU Frequency: 3000000000 Hz
2021-01-16 22:56:58.069893: I tensorflow/compiler/xla/service/service.cc:150] XLA service 0x55a26a2cf290 executing computations on platform Host. Devices:
2021-01-16 22:56:58.069918: I tensorflow/compiler/xla/service/service.cc:158]   StreamExecutor device (0): <undefined>, <undefined>
2021-01-16 22:56:58.070092: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1433] Found device 0 with properties: 
name: Tesla V100-PCIE-32GB major: 7 minor: 0 memoryClockRate(GHz): 1.38
pciBusID: 0000:21:01.0
totalMemory: 31.75GiB freeMemory: 31.44GiB
2021-01-16 22:56:58.070114: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1512] Adding visible gpu devices: 0
2021-01-16 22:56:58.072475: I tensorflow/core/common_runtime/gpu/gpu_device.cc:984] Device interconnect StreamExecutor with strength 1 edge matrix:
2021-01-16 22:56:58.072500: I tensorflow/core/common_runtime/gpu/gpu_device.cc:990]      0 
2021-01-16 22:56:58.072507: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1003] 0:   N 
2021-01-16 22:56:58.072584: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1115] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 30583 MB memory) -> physical GPU (device: 0, name: Tesla V100-PCIE-32GB, pci bus id: 0000:21:01.0, compute capability: 7.0)
WARNING:tensorflow:From /home/work/anaconda/lib/python3.6/site-packages/keras/backend/tensorflow_backend.py:3733: calling dropout (from tensorflow.python.ops.nn_ops) with keep_prob is deprecated and will be removed in a future version.
Instructions for updating:
Please use `rate` instead of `keep_prob`. Rate should be set to `rate = 1 - keep_prob`.
mkdir: cannot create directory ‘logs’: File exists
[ModelArts Service Log]modelarts-pipe: will create log file /tmp/log/MA-01-15-18-26.log
[ModelArts Service Log]modelarts-pipe: will create log file /tmp/log/MA-01-15-18-26.log
[ModelArts Service Log]modelarts-pipe: will write log file /tmp/log/MA-01-15-18-26.log
[ModelArts Service Log]modelarts-pipe: param for max log length: 1073741824
[ModelArts Service Log]modelarts-pipe: param for whether exit on overflow: 0
声学模型参数：
[('is_training', True), ('learning_rate', 0.0008), ('vocab_size', 407)]
加载声学模型
声学模型参数：
[('is_training', True), ('learning_rate', 0.0008), ('vocab_size', 407)]
加载声学模型完成！
WARNING:tensorflow:From /cache/user-job-dir/code/language_model.py:28: dropout (from tensorflow.python.layers.core) is deprecated and will be removed in a future version.
Instructions for updating:
Use keras.layers.dropout instead.
WARNING:tensorflow:From /cache/user-job-dir/code/utils/reLayers.py:148: dense (from tensorflow.python.layers.core) is deprecated and will be removed in a future version.
Instructions for updating:
Use keras.layers.dense instead.
WARNING:tensorflow:From /cache/user-job-dir/code/utils/reLayers.py:211: conv1d (from tensorflow.python.layers.convolutional) is deprecated and will be removed in a future version.
Instructions for updating:
Use keras.layers.conv1d instead.
WARNING:tensorflow:From /cache/user-job-dir/code/language_model.py:44: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.cast instead.
WARNING:tensorflow:From /cache/user-job-dir/code/language_model.py:45: to_float (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.cast instead.
2021-01-16 22:57:06.774847: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1512] Adding visible gpu devices: 0
2021-01-16 22:57:06.774901: I tensorflow/core/common_runtime/gpu/gpu_device.cc:984] Device interconnect StreamExecutor with strength 1 edge matrix:
2021-01-16 22:57:06.774908: I tensorflow/core/common_runtime/gpu/gpu_device.cc:990]      0 
2021-01-16 22:57:06.774912: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1003] 0:   N 
2021-01-16 22:57:06.774984: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1115] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 30583 MB memory) -> physical GPU (device: 0, name: Tesla V100-PCIE-32GB, pci bus id: 0000:21:01.0, compute capability: 7.0)
加载语言模型
WARNING:tensorflow:From /home/work/anaconda/lib/python3.6/site-packages/tensorflow/python/training/saver.py:1266: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
INFO:tensorflow:Restoring parameters from ./model_language/model_language
语言模型参数：
[('dropout_rate', 0.2), ('hidden_units', 512), ('input_vocab_size', 407), ('is_training', True), ('label_vocab_size', 487), ('learning_rate', 0.0008), ('max_length', 100), ('num_blocks', 6), ('num_heads', 8)]
加载语言模型完成！
示例 1
2021-01-16 22:57:08.563558: I tensorflow/stream_executor/dso_loader.cc:152] successfully opened CUDA library libcublas.so.10.0 locally
原文拼音： lv4 shi4 yang2 chun1 yan1 jing3 da4 kuai4 wen2 zhang1 de5 di3 se4 si4 yue4 de5 lin2 luan2 geng4 shi4 lv4 de5 xian1 huo2 xiu4 mei4 shi1 yi4 ang4 ran2
识别结果： 
Traceback (most recent call last):
  File "code/ASR.py", line 80, in <module>
    x = np.array([train_data.pin_vocab.index(pin) for pin in text])
  File "code/ASR.py", line 80, in <listcomp>
    x = np.array([train_data.pin_vocab.index(pin) for pin in text])
ValueError: '' is not in list
[ModelArts Service Log]modelarts-pipe: total length: 6079
[Modelarts Service Log]Training end with return code: 1
[Modelarts Service Log]Training completed.
